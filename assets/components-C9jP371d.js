import{R as W,r as o,j as t,F as O,f as ee,a as te,B as w,b as se,c as oe,d as ae,e as le,g as re,v as Z,E as ne,h as ce,C as ie,A as de,p as ue,i as he,P as be}from"./vendor-eC3yqeVq.js";function ge(s,u){let i;return function(...h){clearTimeout(i),i=setTimeout(()=>s.apply(this,h),u)}}const fe=W.memo(W.forwardRef(({testCase:s,onChange:u,onStatusChange:i,onCheckboxChange:h,isChecked:m,onClick:r,runAutomation:v},k)=>{const[E,x]=o.useState(!1);o.useState(null);const g=()=>{navigator.clipboard.writeText(s.id).then(()=>{x(!0),w.success("Test case ID copied!",{autoClose:1e3}),setTimeout(()=>x(!1),2e3)}).catch(()=>{w.error("Failed to copy ID.",{autoClose:1e3})})};return t.jsxs("div",{className:"py-2 flex items-center border-gray-600 space-x-5 overflow-x-hidden mr-3","data-replicated-value":s.content,onClick:r,children:[t.jsxs("label",{className:"container flex w-1",children:[t.jsx("input",{type:"checkbox",checked:m,onChange:h,className:"checkbox peer"}),t.jsx("span",{className:"checkmark rounded border border-gray-500 hover:border-gray-50 peer-checked:bg-sky-700 peer-checked:border-none"})]}),s.status!==""&&t.jsx("label",{className:"test-id-con truncate w-[7%] p-1 hover:bg-gray-800 rounded-lg",children:t.jsxs("div",{className:"cursor-pointer text-gray-600 flex items-center group",onClick:g,children:[t.jsx(O,{icon:ee,className:"ease-in mr-1 text-gray-400 text-gray-600 invisible group-hover:visible transition-opacity duration-200"}),t.jsx("p",{className:"ease-in",children:s.id})]})}),t.jsx("div",{className:`w-[80%] ${s.status==="",""}`,children:t.jsx("textarea",{ref:k,className:`px-3 bg-inherit rounded overflow-hidden resize-none w-full flex items-center 
              ${s.status===""?"text-gray-400 pl-2":"text-[#FAF9F6] pl-6"}  
              ${s.isBold?"bold-textarea focus:outline-none":"text-sm"}
            `,value:s.content,onChange:n=>u(n.target.value),placeholder:`Test case ${s.id}`,rows:s.status===""?1:""})}),t.jsx("div",{className:"status-con w-[20%] flex items-center justify-center",children:s.status!==""&&t.jsxs("select",{className:`p-1 cursor-pointer text-sm rounded focus:outline-none font-bold ${s.status==="notstarted"?"bg-yellow-200":s.status==="passed"?"bg-[#97BD61]":s.status==="failed"?"bg-rose-300":s.status==="blocked"?"bg-indigo-200":s.status==="notapplicable"?"bg-gray-300":"bg-yellow-200"}`,value:s.status,onChange:n=>i(n.target.value),children:[t.jsx("option",{className:"bg-slate-200 font-bold",value:"notstarted",children:"NOT STARTED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"passed",children:"PASSED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"failed",children:"FAILED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"blocked",children:"BLOCKED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"notapplicable",children:"NOT APPLICABLE"})]})}),t.jsx("div",{className:"automate-con w-[15%] flex items-center justify-center",children:s.status!=""&&t.jsx("button",{className:"automate p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9] ",onClick:v,children:t.jsx(O,{icon:te,size:"lg",color:"white"})})})]},s.id)})),T={DEFAULT:"#1C1C1E",SECOND:"#F39F5A",THIRD:"#9D3233"},me=({isOpen:s,onClose:u,nodeId:i,nodeLabel:h,nodeColor:m="#1C1C1E",testCases:r,onSave:v})=>{const[k,E]=o.useState(h),[x,g]=o.useState(m||T.DEFAULT),[n,j]=o.useState(r),[A,I]=o.useState([]),S=o.useRef([]),[V,b]=o.useState(m||T.DEFAULT),[c,y]=o.useState(""),[F,p]=o.useState(!1);o.useEffect(()=>{j(r)},[r,i]);const N={toastSave:()=>{w.success("Changes Saved Successfully!",{autoClose:1e3})},toastSaveError:()=>{w.error("Failed to save data. Please try again.",{autoClose:1e3})}},D=o.useCallback(ge(async()=>{try{if(!i)throw new Error("Node ID is not defined");const e=n.length,a=n.filter(C=>C.status==="passed").length,l=n.filter(C=>C.status==="failed").length,f=n.filter(C=>C.status==="notstarted").length,z=n.filter(C=>C.status==="blocked").length,K=n.filter(C=>C.status==="notapplicable").length;v&&v(n,k,x,{total:e,passed:a,failed:l,pending:f,blocked:z,notApplicable:K}),N.toastSave()}catch(e){console.error("Failed to save data:",e),N.toastSaveError()}},1e3),[n,k,x,i,v,N]),d=o.useCallback(()=>{requestAnimationFrame(()=>{const e=S.current.map(a=>a?(a.style.height="auto",a.scrollHeight):0);S.current.forEach((a,l)=>{a&&(a.style.height=`${e[l]}px`)})})},[]),P=o.useCallback(()=>{d(),D()},[d,D]),B=o.useCallback(e=>{const a=e.target.value;/^#[0-9A-Fa-f]{6}$/.test(a)?(g(a),b(a)):console.error("Invalid color format. Please use #rrggbb format.")},[]),M=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"",isBold:!0};j(a=>[...a,e])},[]),$=o.useCallback((e,a)=>{j(l=>l.map(f=>f.id===e?{...f,content:a}:f))},[]),L=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"notstarted"};j(a=>[...a,e])},[]),R=o.useCallback((e,a)=>{j(l=>l.map(f=>f.id===e?{...f,status:a}:f))},[]),H=o.useCallback(()=>{j(e=>e.filter(a=>!A.includes(a.id))),I([])},[A]),G=o.useCallback(e=>{if(e.target.checked){const a=n.map(l=>l.id);I(a)}else I([])},[n]),Q=o.useCallback(e=>{I(a=>a.includes(e)?a.filter(l=>l!==e):[...a,e])},[]),U=n.filter(e=>e.content.toLowerCase().includes(c.toLowerCase())),q=o.useCallback(e=>{S.current[e]&&(S.current[e].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),S.current[e].focus())},[]),X=o.useCallback(e=>{c&&(y(""),setTimeout(()=>{q(e)},0))},[c,q]);o.useEffect(()=>{s&&(E(h),g(m||T.DEFAULT),j(r),I([]))},[h,r,m,s]),o.useEffect(()=>{const e=JSON.parse(localStorage.getItem(`testCases-${i}`)),a=localStorage.getItem(`label-${i}`),l=localStorage.getItem(`color-${i}`);a&&E(a),e&&j(e),l&&(g(l),b(l)),setTimeout(()=>{document.querySelectorAll(".modal-content textarea").forEach(z=>{z.parentNode.dataset.replicatedValue=z.value})},0)},[i,s]);const _=o.useCallback(e=>{F||(e.ctrlKey&&e.key==="Enter"?(c&&y(""),L(),p(!0)):e.altKey&&e.key==="Enter"?(c&&y(""),M(),p(!0)):e.ctrlKey&&e.key.toLowerCase()==="s"?(e.preventDefault(),document.querySelector(".modal-save").focus(),P(),p(!0)):e.ctrlKey&&e.key.toLowerCase()==="f"&&(e.preventDefault(),document.querySelector(".search-input").focus(),p(!0)),setTimeout(()=>{p(!1)},100))},[c,L,M,F]);o.useEffect(()=>(document.addEventListener("keydown",_),()=>{document.removeEventListener("keydown",_)}),[_]),o.useEffect(()=>{s&&d()},[s,d]),o.useEffect(()=>{var e;S.current.length>0&&(S.current.forEach(a=>{a&&(a.style.height="auto")}),(e=S.current[S.current.length-1])==null||e.focus())},[n.length]),o.useEffect(()=>{const e=document.querySelector(".modal-content");e&&(e.style.borderTopColor=V)},[V]);const Y=o.useCallback(async(e,a)=>{try{const l=await fetch("http://localhost:3000/run-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testCaseId:e})}),f=await l.json();if(l.ok&&f.result!=""){w.success("Python script executed successfully!",{autoClose:1e3});const z=f.result,K=z.match(/(\| PASS \|)/),J=z.match(/(\| FAIL \|)/);let C;K?C="passed":J?C="failed":C=a,R(e,C)}else if(f.result=="")w.error(`Suite 'Testsuites' contains no tests or tasks matching tag ${e}.`,{autoClose:1e3}),R(e,"blocked");else throw new Error("Failed to execute script: "+f.message)}catch(l){console.error("Error running Python script:",l),w.error("Failed to execute Python script.",{autoClose:1e3})}},[R,P]);return t.jsx(t.Fragment,{children:s&&t.jsx("div",{className:"modal-overlay z-0 select-none",onClick:u,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[70%] border-t-4",style:{borderColor:x},onClick:e=>e.stopPropagation(),children:[t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:u,children:"×"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"text",className:"bg-inherit text-slate-200 font-bold p-1 rounded mr-5 w-2/3 text-xl focus:outline focus:outline-white",value:k,onChange:e=>E(e.target.value),placeholder:"Node Label"}),t.jsxs("div",{className:"flex items-center w-fit space-x-3 px-2 ml-10",children:[t.jsx("button",{onClick:()=>B({target:{value:T.DEFAULT}}),className:`w-8 h-8 rounded border-2 ${x===T.DEFAULT?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:T.DEFAULT},"aria-label":"DEFAULT"}),t.jsx("button",{onClick:()=>B({target:{value:T.SECOND}}),className:`w-8 h-8 rounded border-2 ${x===T.SECOND?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:T.SECOND},"aria-label":"SECOND"}),t.jsx("button",{onClick:()=>B({target:{value:T.THIRD}}),className:`w-8 h-8 rounded border-2 ${x===T.THIRD?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:T.THIRD},"aria-label":"THIRD"})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"p-2 rounded flex items-center border-gray-600 cursor-pointer space-x-4 ",children:[t.jsx("input",{type:"checkbox",onChange:G,checked:A.length===n.length&&n.length>0}),t.jsx("span",{className:"text-white",children:"Select All"})]}),t.jsx("input",{type:"text",className:"search-input placeholder:italic p-1 px-3 text-sm text-white rounded border border-gray-600 bg-inherit",placeholder:"Search keywords...",value:c,onChange:e=>y(e.target.value)})]}),t.jsx("hr",{className:"mt-2 border-gray-600 border-1"}),c&&t.jsxs("label",{className:"text-gray-400 text-xs",children:[U.length," test case",U.length>1?"s":""," found"]}),t.jsxs("header",{className:"test-header flex text-center text-white p-2 divide-x divide-gray-600 border-b border-gray-600",children:[t.jsx("div",{className:"w-[10%]",children:"Test ID"}),t.jsx("div",{className:"w-[60%]",children:"Test Case"}),t.jsx("div",{className:"w-[15%]",children:"Status"}),t.jsx("div",{className:"w-[12%] ml-auto",children:"Automation"})]}),t.jsx("div",{className:"modal-body overflow-y-auto pb-[10px] divide-y divide-dashed",children:U.map((e,a)=>t.jsx(fe,{testCase:e,onChange:l=>$(e.id,l),onStatusChange:l=>R(e.id,l),onCheckboxChange:()=>Q(e.id),isChecked:A.includes(e.id),ref:l=>S.current[n.findIndex(f=>f.id===e.id)]=l,onClick:()=>X(n.findIndex(l=>l.id===e.id)),runAutomation:()=>Y(e.id,e.status)},e.id))}),t.jsxs("div",{className:"button-container sticky bottom-0 left-0 right-0 bg-[#1C1C1E] pt-5 space-x-3 z-10",children:[t.jsx("button",{className:"p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:L,children:t.jsx(O,{icon:se,size:"lg",color:"white"})}),t.jsx("button",{className:"modal-save p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:P,children:t.jsx(O,{icon:oe,size:"lg",color:"white"})}),t.jsx("button",{className:`p-2 rounded w-12 ${A.length>0?"bg-red-600 hover:bg-red-800":"bg-gray-600 cursor-not-allowed"}`,onClick:H,disabled:A.length===0,style:{cursor:A.length===0?"not-allowed":"pointer"},children:t.jsx(O,{icon:ae,size:"lg",color:"white"})})]})]})})})},we=me,xe=({isOpen:s,onClose:u,onSelectVersion:i})=>{const[h,m]=o.useState([]);return o.useEffect(()=>{s&&fetch("http://localhost:3000/versions.json").then(r=>{if(!r.ok)throw new Error("Failed to fetch flow data");return r.json()}).then(r=>{if(r.versions){const k=r.versions.sort((E,x)=>new Date(x.timestamp)-new Date(E.timestamp));m(k)}else console.error("Invalid data structure:",r)}).catch(r=>{console.error("Failed to fetch versions:",r)})},[s]),s?t.jsx("div",{className:"modal-overlay z-0 select-none text-slate-200",onClick:u,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[500px]",onClick:r=>r.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{className:"font-bold text-xl",children:"Version History"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:u,children:"×"}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"})]}),t.jsx("div",{className:"modal-body divide-y divide-dashed ",children:h.length===0?t.jsx("p",{children:"No versions available."}):t.jsx("ul",{className:"space-y-3 peer",children:h.map((r,v)=>t.jsx("li",{children:t.jsxs("button",{className:"link-button border border-gray-600 w-full px-2 text-right pr-7 py-2 rounded hover:bg-gray-800 hover:border-white",onClick:()=>i(r.flowData),children:[t.jsx(O,{icon:le,className:"float-left peer-hover:pl-10",size:"lg",color:"white"}),re(new Date(r.timestamp),"MMMM dd, h:mm a")]})},v))})})]})}):null},ke=xe,pe=()=>{const s=o.useCallback(()=>{w.error("No node selected to delete.",{autoClose:1e3})},[]),u=o.useCallback(()=>{w.success("Node Deleted.",{autoClose:1e3})},[]),i=o.useCallback(()=>{w.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),h=o.useCallback(()=>{w.success("Changes saved successfully!",{autoClose:1e3})},[]),m=o.useCallback(()=>{w.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),r=o.useCallback(()=>{w.success("Changes saved locally!",{autoClose:1e3})},[]);return{toastDelete:s,toastDeleteSuccess:u,toastSaveError:i,toastSaveSuccess:h,toastSaveErrorLocal:m,toastSaveLocalSuccess:r}},ve=(s,u,i,h,m,r,v,k)=>{const{toastDelete:E,toastDeleteSuccess:x,toastSaveError:g,toastSaveSuccess:n}=pe(),j=o.useCallback(()=>{const b=s[s.length-1],c=b?b.position:{x:0,y:0},y={id:Z(),position:{x:c.x+100,y:c.y+100},data:{label:`Test Scenario ${s.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};u(F=>[...F,y])},[s,u]),A=o.useCallback(()=>{const b=s[s.length-1],c=b?b.position:{x:0,y:0},y={id:Z(),position:{x:c.x+100,y:c.y+100},type:"connector",data:{label:`${s.length+1}`},sourcePosition:"right",targetPosition:"left"};u(F=>[...F,y])},[s,u]),I=o.useCallback(async()=>{console.time("Export to Excel");const b=new ne.Workbook,c=new Set,y=N=>{const D=N.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let d=D,P=1;for(;c.has(d);)d=`${D}_${P}`,P++,d.length>31&&(d=d.slice(0,31));return c.add(d),d};for(const N of s)if(N.data.testCases&&N.data.testCases.length>0){const D=N.data.label||`Sheet${s.indexOf(N)+1}`,d=y(D),P=N.data.testCases||[];console.log(`Processing node: ${D}`),console.log("Test Cases:",P);const B=b.addWorksheet(d);B.addRow(["Test ID","Test Case","Status"]),P.forEach(($,L)=>{B.addRow([L+1,$.content,$.status,$.description||""])}),(()=>{B.columns.forEach($=>{let L=0;$.eachCell({includeEmpty:!0},R=>{const H=R.value?R.value.toString().length:0;H>L&&(L=H)}),$.width=L})})(),console.timeEnd(`Creating sheet for ${d}`)}console.timeEnd("Export to Excel");const F=await b.xlsx.writeBuffer(),p=new Blob([F],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ce.saveAs(p,"test_cases.xlsx"),console.log("File saved!")},[s]),S=o.useCallback(()=>{h?(u(b=>b.filter(c=>c.id!==h.id)),i(b=>b.filter(c=>c.source!==h.id&&c.target!==h.id)),x(),m(!1),r(null)):E()},[h,u,i,m]),V=o.useCallback(()=>{if(v){const b=v.toObject(),c=k(b.nodes),y=JSON.stringify({...b,testCaseStats:c},null,4),F=p=>{const D={timestamp:new Date().toISOString(),flowData:p};fetch("http://localhost:3000/flow/saveVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}).then(d=>d.json()).then(d=>{d?console.log("Version saved to server:",d.message):g()}).catch(d=>{console.error("Failed to save version to server:",d),g()})};fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:y}).then(p=>p.json()).then(p=>{p?(n(),F(y)):g()}).catch(p=>{console.error("Failed to save flow data to server:",p),g()})}else g()},[v,k,g,n]);return{addNode:j,addConnectorNode:A,exportToExcel:I,deleteSelectedNode:S,onSave:V}},je=ve;ie.register(de,ue,he);const Ce=({isOpen:s,onClose:u,testCaseData:i})=>{if(!s)return null;const{notstarted:h,passed:m,failed:r,blocked:v,notapplicable:k}=i,E={labels:["Not Started","Passed","Failed","Blocked","Not Applicable"],datasets:[{label:"Test Case Status",data:[h,m,r,v,k],backgroundColor:["rgba(254, 240, 138, 0.6)","rgba(151, 189, 97, 0.6)","rgba(253, 164, 175, 0.6)","rgba(199, 210, 254, 0.6)","rgba(209, 213, 219, 0.6)"],borderColor:["rgba(254, 240, 138, 1)","rgba(151, 189, 97, 1)","rgba(253, 164, 175, 1)","rgba(199, 210, 254, 1)","rgba(209, 213, 219, 1)"],borderWidth:1}]},x={responsive:!0,plugins:{legend:{position:"bottom",labels:{boxHeight:10,boxWidth:20,padding:10}},tooltip:{callbacks:{label:function(g){const n=g.label||"",j=g.raw||0;return`${n}: ${j}`}}}}};return t.jsx("div",{className:"modal-overlay z-50 select-none",onClick:u,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col p-6 max-h-[90vh] min-w-[500px] relative",onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-5",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:"Test Status Chart"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:u,children:"×"})]}),t.jsx("div",{className:"flex justify-center items-center flex-1",children:t.jsx(be,{data:E,options:x})}),t.jsx("div",{className:"mt-4 text-center text-slate-200",children:t.jsxs("p",{children:["Total Test Cases: ",i.total]})})]})})},Se=Ce;export{je as B,we as M,Se as P,ke as V};
