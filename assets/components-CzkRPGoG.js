import{R as q,r as o,j as t,F as B,f as Q,a as X,B as y,b as Y,c as ee,d as te,e as se,g as oe,v as J,E as ae,h as le}from"./vendor-74Lx4DoW.js";function re(s,f){let d;return function(...u){clearTimeout(d),d=setTimeout(()=>s.apply(this,u),f)}}const ce=q.memo(q.forwardRef(({testCase:s,onChange:f,onStatusChange:d,onCheckboxChange:u,isChecked:b,onClick:r},C)=>{const[D,E]=o.useState(!1);o.useState(null);const w=()=>{navigator.clipboard.writeText(s.id).then(()=>{E(!0),y.success("Test case ID copied!",{autoClose:1e3}),setTimeout(()=>E(!1),2e3)}).catch(()=>{y.error("Failed to copy ID.",{autoClose:1e3})})},S=async()=>{try{const l=await fetch("http://localhost:3000/run-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testCaseId:s.id})}),m=await l.json();if(l.ok&&m.result!=""){y.success("Python script executed successfully!",{autoClose:1e3});const p=m.result;console.log(`Script Result: ${p}`),console.log(`Error?: ${m.Error}`);const A=p.match(/(\| PASS \|)/),x=p.match(/(\| FAIL \|)/);let L;A?L="passed":x?L="failed":L=s.status,d(L)}else if(m.result=="")y.error(`[ ERROR ] Suite 'Testsuites' contains no tests or tasks matching tag ${s.id}.`,{autoClose:1e3});else throw new Error("Failed to execute script: "+m.message)}catch(l){console.error("Error running Python script:",l),y.error("Failed to execute Python script.",{autoClose:1e3})}};return t.jsxs("div",{className:"py-2 flex items-center border-gray-600 space-x-5 overflow-x-hidden mr-3","data-replicated-value":s.content,onClick:r,children:[t.jsxs("label",{className:"container flex w-1",children:[t.jsx("input",{type:"checkbox",checked:b,onChange:u,className:"checkbox peer"}),t.jsx("span",{className:"checkmark rounded border border-gray-500 hover:border-gray-50 peer-checked:bg-sky-700 peer-checked:border-none"})]}),s.status!==""&&t.jsx("label",{className:"test-id-con truncate w-[7%] p-1 hover:bg-gray-800 rounded-lg",children:t.jsxs("div",{className:"cursor-pointer text-gray-600 flex items-center group",onClick:w,children:[t.jsx(B,{icon:Q,className:"ease-in mr-1 text-gray-400 text-gray-600 invisible group-hover:visible transition-opacity duration-200"}),t.jsx("p",{className:"ease-in",children:s.id})]})}),t.jsx("div",{className:`w-[80%] ${s.status==="",""}`,children:t.jsx("textarea",{ref:C,className:`px-3 bg-inherit rounded overflow-hidden resize-none w-full flex items-center 
              ${s.status===""?"text-gray-400 pl-2":"text-[#FAF9F6] pl-6"}  
              ${s.isBold?"bold-textarea focus:outline-none":"text-sm"}
            `,value:s.content,onChange:l=>f(l.target.value),placeholder:`Test case ${s.id}`,rows:s.status===""?1:""})}),t.jsx("div",{className:"status-con w-[20%] flex items-center justify-center",children:s.status!==""&&t.jsxs("select",{className:`p-1 cursor-pointer text-sm rounded focus:outline-none ${s.status==="notstarted"?"bg-yellow-200":s.status==="passed"?"bg-green-200":s.status==="failed"?"bg-rose-300":s.status==="blocked"?"bg-indigo-200":s.status==="notapplicable"?"bg-gray-300":"bg-yellow-200"}`,value:s.status,onChange:l=>d(l.target.value),children:[t.jsx("option",{className:"bg-slate-200",value:"notstarted",children:"NOT STARTED"}),t.jsx("option",{className:"bg-slate-200",value:"passed",children:"PASSED"}),t.jsx("option",{className:"bg-slate-200",value:"failed",children:"FAILED"}),t.jsx("option",{className:"bg-slate-200",value:"blocked",children:"BLOCKED"}),t.jsx("option",{className:"bg-slate-200",value:"notapplicable",children:"NOT APPLICABLE"})]})}),t.jsx("div",{className:"automate-con w-[15%] flex items-center justify-center",children:s.status!=""&&t.jsx("button",{className:"automate p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9] ",onClick:S,children:t.jsx(B,{icon:X,size:"lg",color:"white"})})})]},s.id)})),j={DEFAULT:"#1C1C1E",SECOND:"#F39F5A",THIRD:"#9D3233"},ne=({isOpen:s,onClose:f,nodeId:d,nodeLabel:u,nodeColor:b="#1C1C1E",testCases:r,onSave:C})=>{const[D,E]=o.useState(u),[w,S]=o.useState(b||j.DEFAULT),[l,m]=o.useState(r),[p,A]=o.useState([]),x=o.useRef([]),[L,h]=o.useState(b||j.DEFAULT),[c,v]=o.useState(""),[T,g]=o.useState(!1);o.useEffect(()=>{m(r)},[r,d]);const k={toastSave:()=>{y.success("Changes Saved Successfully!",{autoClose:1e3})},toastSaveError:()=>{y.error("Failed to save data. Please try again.",{autoClose:1e3})}},F=o.useCallback(re(async()=>{try{if(!d)throw new Error("Node ID is not defined");const e=l.length,a=l.filter(O=>O.status==="passed").length,n=l.filter(O=>O.status==="failed").length,N=l.filter(O=>O.status==="notstarted").length,H=l.filter(O=>O.status==="notapplicable").length;C&&C(l,D,w,{total:e,passed:a,failed:n,pending:N,notApplicable:H}),k.toastSave()}catch(e){console.error("Failed to save data:",e),k.toastSaveError()}},1e3),[l,D,w,d,C,k]),i=o.useCallback(()=>{requestAnimationFrame(()=>{const e=x.current.map(a=>a?(a.style.height="auto",a.scrollHeight):0);x.current.forEach((a,n)=>{a&&(a.style.height=`${e[n]}px`)})})},[]),P=o.useCallback(()=>{i(),F()},[i,F]),R=o.useCallback(e=>{const a=e.target.value;/^#[0-9A-Fa-f]{6}$/.test(a)?(S(a),h(a)):console.error("Invalid color format. Please use #rrggbb format.")},[]),M=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"",isBold:!0};m(a=>[...a,e])},[]),I=o.useCallback((e,a)=>{m(n=>n.map(N=>N.id===e?{...N,content:a}:N))},[]),$=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"notstarted"};m(a=>[...a,e])},[]),z=o.useCallback((e,a)=>{m(n=>n.map(N=>N.id===e?{...N,status:a}:N))},[]),V=o.useCallback(()=>{m(e=>e.filter(a=>!p.includes(a.id))),A([])},[p]),W=o.useCallback(e=>{if(e.target.checked){const a=l.map(n=>n.id);A(a)}else A([])},[l]),Z=o.useCallback(e=>{A(a=>a.includes(e)?a.filter(n=>n!==e):[...a,e])},[]),U=l.filter(e=>e.content.toLowerCase().includes(c.toLowerCase())),_=o.useCallback(e=>{x.current[e]&&(x.current[e].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),x.current[e].focus())},[]),G=o.useCallback(e=>{c&&(v(""),setTimeout(()=>{_(e)},0))},[c,_]);o.useEffect(()=>{s&&(E(u),S(b||j.DEFAULT),m(r),A([]))},[u,r,b,s]),o.useEffect(()=>{const e=JSON.parse(localStorage.getItem(`testCases-${d}`)),a=localStorage.getItem(`label-${d}`),n=localStorage.getItem(`color-${d}`);a&&E(a),e&&m(e),n&&(S(n),h(n)),setTimeout(()=>{document.querySelectorAll(".modal-content textarea").forEach(H=>{H.parentNode.dataset.replicatedValue=H.value})},0)},[d,s]);const K=o.useCallback(e=>{T||(e.ctrlKey&&e.key==="Enter"?(c&&v(""),$(),g(!0)):e.altKey&&e.key==="Enter"?(c&&v(""),M(),g(!0)):e.ctrlKey&&e.key.toLowerCase()==="s"?(e.preventDefault(),document.querySelector(".modal-save").focus(),P(),g(!0)):e.ctrlKey&&e.key.toLowerCase()==="f"&&(e.preventDefault(),document.querySelector(".search-input").focus(),g(!0)),setTimeout(()=>{g(!1)},100))},[c,$,M,T]);return o.useEffect(()=>(document.addEventListener("keydown",K),()=>{document.removeEventListener("keydown",K)}),[K]),o.useEffect(()=>{s&&i()},[s,i]),o.useEffect(()=>{var e;x.current.length>0&&(x.current.forEach(a=>{a&&(a.style.height="auto")}),(e=x.current[x.current.length-1])==null||e.focus())},[l.length]),o.useEffect(()=>{const e=document.querySelector(".modal-content");e&&(e.style.borderTopColor=L)},[L]),t.jsx(t.Fragment,{children:s&&t.jsx("div",{className:"modal-overlay z-0 select-none",children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[70%] border-t-4",style:{borderColor:w},children:[t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:f,children:"×"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"text",className:"bg-inherit text-slate-200 font-bold p-1 rounded mr-5 w-2/3 text-xl focus:outline focus:outline-white",value:D,onChange:e=>E(e.target.value),placeholder:"Node Label"}),t.jsxs("div",{className:"flex items-center w-fit space-x-3 px-2 ml-10",children:[t.jsx("button",{onClick:()=>R({target:{value:j.DEFAULT}}),className:`w-8 h-8 rounded border-2 ${w===j.DEFAULT?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:j.DEFAULT},"aria-label":"DEFAULT"}),t.jsx("button",{onClick:()=>R({target:{value:j.SECOND}}),className:`w-8 h-8 rounded border-2 ${w===j.SECOND?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:j.SECOND},"aria-label":"SECOND"}),t.jsx("button",{onClick:()=>R({target:{value:j.THIRD}}),className:`w-8 h-8 rounded border-2 ${w===j.THIRD?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:j.THIRD},"aria-label":"THIRD"})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"p-2 rounded flex items-center border-gray-600 cursor-pointer space-x-4 ",children:[t.jsx("input",{type:"checkbox",onChange:W,checked:p.length===l.length&&l.length>0}),t.jsx("span",{className:"text-white",children:"Select All"})]}),t.jsx("input",{type:"text",className:"search-input placeholder:italic p-1 px-3 text-sm text-white rounded border border-gray-600 bg-inherit",placeholder:"Search keywords...",value:c,onChange:e=>v(e.target.value)})]}),t.jsx("hr",{className:"mt-2 border-gray-600 border-1"}),c&&t.jsxs("label",{className:"text-gray-400 text-xs",children:[U.length," test case",U.length>1?"s":""," found"]}),t.jsxs("header",{className:"test-header flex text-center text-white p-2 divide-x divide-gray-600 border-b border-gray-600",children:[t.jsx("div",{className:"w-[10%]",children:"Test ID"}),t.jsx("div",{className:"w-[60%]",children:"Test Case"}),t.jsx("div",{className:"w-[15%]",children:"Status"}),t.jsx("div",{className:"w-[12%] ml-auto",children:"Automation"})]}),t.jsx("div",{className:"modal-body overflow-y-auto pb-[10px] divide-y divide-dashed",children:U.map((e,a)=>t.jsx(ce,{testCase:e,onChange:n=>I(e.id,n),onStatusChange:n=>z(e.id,n),onCheckboxChange:()=>Z(e.id),isChecked:p.includes(e.id),ref:n=>x.current[l.findIndex(N=>N.id===e.id)]=n,onClick:()=>G(l.findIndex(n=>n.id===e.id))},e.id))}),t.jsxs("div",{className:"button-container sticky bottom-0 left-0 right-0 bg-[#1C1C1E] pt-5 space-x-3 z-10",children:[t.jsx("button",{className:"p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:$,children:t.jsx(B,{icon:Y,size:"lg",color:"white"})}),t.jsx("button",{className:"modal-save p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:P,children:t.jsx(B,{icon:ee,size:"lg",color:"white"})}),t.jsx("button",{className:`p-2 rounded w-12 ${p.length>0?"bg-red-600 hover:bg-red-800":"bg-gray-600 cursor-not-allowed"}`,onClick:V,disabled:p.length===0,style:{cursor:p.length===0?"not-allowed":"pointer"},children:t.jsx(B,{icon:te,size:"lg",color:"white"})})]})]})})})},me=ne,ie=({isOpen:s,onClose:f,onSelectVersion:d})=>{const[u,b]=o.useState([]);return o.useEffect(()=>{s&&fetch("http://localhost:3000/versions.json").then(r=>{if(!r.ok)throw new Error("Failed to fetch flow data");return r.json()}).then(r=>{if(r.versions){const D=r.versions.sort((E,w)=>new Date(w.timestamp)-new Date(E.timestamp));b(D)}else console.error("Invalid data structure:",r)}).catch(r=>{console.error("Failed to fetch versions:",r)})},[s]),s?t.jsx("div",{className:"modal-overlay z-0 select-none text-slate-200",onClick:f,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[500px]",onClick:r=>r.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{className:"font-bold text-xl",children:"Version History"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:f,children:"×"}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"})]}),t.jsx("div",{className:"modal-body divide-y divide-dashed ",children:u.length===0?t.jsx("p",{children:"No versions available."}):t.jsx("ul",{className:"space-y-3 peer",children:u.map((r,C)=>t.jsx("li",{children:t.jsxs("button",{className:"link-button border border-gray-600 w-full px-2 text-right pr-7 py-2 rounded hover:bg-gray-800 hover:border-white",onClick:()=>d(r.flowData),children:[t.jsx(B,{icon:se,className:"float-left peer-hover:pl-10",size:"lg",color:"white"}),oe(new Date(r.timestamp),"MMMM dd, h:mm a")]})},C))})})]})}):null},ge=ie,de=()=>{const s=o.useCallback(()=>{y.error("No node selected to delete.",{autoClose:1e3})},[]),f=o.useCallback(()=>{y.success("Node Deleted.",{autoClose:1e3})},[]),d=o.useCallback(()=>{y.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),u=o.useCallback(()=>{y.success("Changes saved successfully!",{autoClose:1e3})},[]),b=o.useCallback(()=>{y.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),r=o.useCallback(()=>{y.success("Changes saved locally!",{autoClose:1e3})},[]);return{toastDelete:s,toastDeleteSuccess:f,toastSaveError:d,toastSaveSuccess:u,toastSaveErrorLocal:b,toastSaveLocalSuccess:r}},ue=(s,f,d,u,b,r,C,D)=>{const{toastDelete:E,toastDeleteSuccess:w,toastSaveError:S,toastSaveSuccess:l}=de(),m=o.useCallback(()=>{const h=s[s.length-1],c=h?h.position:{x:0,y:0},v={id:J(),position:{x:c.x+100,y:c.y+100},data:{label:`Test Scenario ${s.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};f(T=>[...T,v])},[s,f]),p=o.useCallback(()=>{const h=s[s.length-1],c=h?h.position:{x:0,y:0},v={id:J(),position:{x:c.x+100,y:c.y+100},type:"connector",data:{label:`${s.length+1}`},sourcePosition:"right",targetPosition:"left"};f(T=>[...T,v])},[s,f]),A=o.useCallback(async()=>{console.time("Export to Excel");const h=new ae.Workbook,c=new Set,v=k=>{const F=k.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let i=F,P=1;for(;c.has(i);)i=`${F}_${P}`,P++,i.length>31&&(i=i.slice(0,31));return c.add(i),i};for(const k of s)if(k.data.testCases&&k.data.testCases.length>0){const F=k.data.label||`Sheet${s.indexOf(k)+1}`,i=v(F),P=k.data.testCases||[];console.log(`Processing node: ${F}`),console.log("Test Cases:",P);const R=h.addWorksheet(i);R.addRow(["Test ID","Test Case","Status"]),P.forEach((I,$)=>{R.addRow([$+1,I.content,I.status,I.description||""])}),(()=>{R.columns.forEach(I=>{let $=0;I.eachCell({includeEmpty:!0},z=>{const V=z.value?z.value.toString().length:0;V>$&&($=V)}),I.width=$})})(),console.timeEnd(`Creating sheet for ${i}`)}console.timeEnd("Export to Excel");const T=await h.xlsx.writeBuffer(),g=new Blob([T],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});le.saveAs(g,"test_cases.xlsx"),console.log("File saved!")},[s]),x=o.useCallback(()=>{u?(f(h=>h.filter(c=>c.id!==u.id)),d(h=>h.filter(c=>c.source!==u.id&&c.target!==u.id)),w(),b(!1),r(null)):E()},[u,f,d,b]),L=o.useCallback(()=>{if(C){const h=C.toObject(),c=D(h.nodes),v=JSON.stringify({...h,testCaseStats:c},null,4),T=g=>{const F={timestamp:new Date().toISOString(),flowData:g};fetch("http://localhost:3000/flow/saveVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)}).then(i=>i.json()).then(i=>{i?console.log("Version saved to server:",i.message):S()}).catch(i=>{console.error("Failed to save version to server:",i),S()})};fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:v}).then(g=>g.json()).then(g=>{g?(l(),T(v)):S()}).catch(g=>{console.error("Failed to save flow data to server:",g),S()})}else S()},[C,D,S,l]);return{addNode:m,addConnectorNode:p,exportToExcel:A,deleteSelectedNode:x,onSave:L}},xe=ue;export{xe as B,me as M,ge as V};
